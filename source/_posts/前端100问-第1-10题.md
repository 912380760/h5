---
title: 前端100问 第1-10题
date: 2019-07-15 18:15:38
tags: js
---

# 写 React/Vue 项目时为什么要在列表组件中写key,其作用是什么?
## 不带key的作用
不带有key,并且使用简单的模板,可以更有效的复用节点,diff速度也更块,因为带key在增删节点上有耗时,这就是vue的默认模式.  
这种模式会带来一些隐晦的副作用,比如可能不会产生过渡效果,或者某些节点有绑定数据状态(表单),会出现状态错位.  
vue文档也说明了**这个默认模式是高效的,但是只适用于不依赖只组件状态或临时DOM状态的列表渲染输出**.

以下是简单的例子:
```html
<div id="app">
    <div v-for=""i in dataList>{{i}}</div>
</div>
```
```js
const vm = new Vue({
    el: '#app',
    data: {
        datalist: [1, 2, 3, 4, 5],
    }
})

// 我们给每个节点标记一个ID来标明身份
[
    '<div>1</div>', // id： A
    '<div>2</div>', // id:  B
    '<div>3</div>', // id:  C
    '<div>4</div>', // id:  D
    '<div>5</div>'  // id:  E
]

// 进行数据位置替换
vm.dataList = [4, 1, 3, 5, 2];
// 没key的情况,节点位置没变,innerText内容更新了
[
    '<div>4</div>', // id： A
    '<div>1</div>', // id:  B
    '<div>3</div>', // id:  C
    '<div>5</div>', // id:  D
    '<div>2</div>'  // id:  E
]
// 有key的情况,dom节点位置交换了,内容没有更新
// <div v-for="i in dataList" :key='i'>{{ i }}</div>
[
    '<div>4</div>', // id:  D
    '<div>1</div>', // id： A
    '<div>3</div>', // id:  C
    '<div>5</div>'  // id:  E
    '<div>2</div>', // id:  B
]

// 增删列表项
vm.dataList = [3, 4, 5, 6, 7];
// 没有key的情况,节点位置不变,innerText内容更新了
[
    '<div>3</div>', // id： A
    '<div>4</div>', // id:  B
    '<div>5</div>', // id:  C
    '<div>6</div>', // id:  D
    '<div>7</div>'  // id:  E
]
// 有key的情况,删除了 A,B 节点,新增了 F,G 节点
[
    '<div>3</div>', // id： C
    '<div>4</div>', // id:  D
    '<div>5</div>', // id:  E
    '<div>6</div>', // id:  F
    '<div>7</div>'  // id:  G
]
```

## key的作用
key是给每个vnode(虚拟DOM)的唯一id,可以**依靠key**更**准确**、更**快**的拿到oldVnode中对应的vnode节点.
1. 更准确
因为不带啊key就不是就地复用了,会对比新旧节点key是否相等,所以会更加准确
2. 更快
利用key的唯一性生成map对象遍历来获取对应节点,比遍历方式更快(map对象是通过key/value直接获取值对比,而遍历需要遍历整个数组).
